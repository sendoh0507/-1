<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ğŸ“š OOå­¸æ ¡ é»åç‰ˆ ğŸ“š</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: #2e2e2e;
      color: #fff;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #3c3f41;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 20px;
    }
    input, select, button {
      padding: 8px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
    }
    select, input {
      background: #1e1e1e;
      color: #fff;
    }
    button {
      background: #4caf50;
      color: #fff;
      cursor: pointer;
    }
    button.danger {
      background: #f44336;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      overflow-x: auto;
    }
    th, td {
      border: 1px solid #555;
      padding: 8px;
      text-align: center;
      min-width: 80px;
    }
    th {
      background: #2a2d2e;
      white-space: nowrap;
    }
    td.day-cell {
      cursor: pointer;
      background: #424242;
      user-select: none;
    }
    td.day-cell.signed {
      background: #81c784;
      font-weight: bold;
      color: #000;
    }
    #studentCount {
      margin-left: 10px;
      white-space: nowrap;
    }
    @media (max-width: 768px) {
      .controls {
        flex-direction: column;
        gap: 8px;
      }
      table {
        display: block;
        overflow-x: auto;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“š <span id="titleSchool">OOå­¸æ ¡</span> <span id="titleCourse">(èª²ç¨‹)</span> é»åç‰ˆ ğŸ“š</h1>
    <div class="controls">
      <select id="schoolSelect" style="min-width:150px;"></select>
      <button onclick="addSchool()">æ–°å¢å­¸æ ¡</button>
      <button onclick="deleteSchool()" class="danger">åˆªé™¤å­¸æ ¡</button>
      <input type="text" id="courseInput" placeholder="è«‹è¼¸å…¥èª²ç¨‹åç¨±" style="min-width:150px; flex-grow:1;">
      <button onclick="setCourse()">è¨­å®šèª²ç¨‹</button>
      <select id="yearSelect" style="min-width:90px;"></select>
      <select id="monthSelect" style="min-width:90px;"></select>
      <input type="text" id="studentInput" placeholder="è¼¸å…¥æ–°å­¸ç”Ÿ" style="min-width:150px;">
      <button onclick="addStudent()">æ–°å¢å­¸ç”Ÿ</button>
      <div id="studentCount">ğŸ‘¥ å…± 0 ä½å­¸ç”Ÿ</div>
    </div>
    <table>
      <thead>
        <tr>
          <th>å§“å</th>
          <th class="date-header">é€±ä¸€<br><span id="d1">-</span></th>
          <th class="date-header">é€±äºŒ<br><span id="d2">-</span></th>
          <th class="date-header">é€±ä¸‰<br><span id="d3">-</span></th>
          <th class="date-header">é€±å››<br><span id="d4">-</span></th>
          <th class="date-header">é€±äº”<br><span id="d5">-</span></th>
          <th class="date-header">é€±å…­<br><span id="d6">-</span></th>
          <th class="date-header">é€±æ—¥<br><span id="d7">-</span></th>
          <th>åˆªé™¤</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
  <script>
    const yearSelect = document.getElementById("yearSelect");
    const monthSelect = document.getElementById("monthSelect");
    const schoolSelect = document.getElementById("schoolSelect");
    const studentInput = document.getElementById("studentInput");
    const tableBody = document.getElementById("tableBody");
    const titleSchool = document.getElementById("titleSchool");
    const titleCourse = document.getElementById("titleCourse");
    const courseInput = document.getElementById("courseInput");
    const studentCount = document.getElementById("studentCount");

    // è³‡æ–™çµæ§‹
    // schoolData = { "å­¸æ ¡å": [å­¸ç”Ÿå1, å­¸ç”Ÿå2, ...], ... }
    // courseMap = { "å­¸æ ¡å": "èª²ç¨‹åç¨±", ... }

    let schoolData = JSON.parse(localStorage.getItem("schoolData") || "{}");
    let courseMap = JSON.parse(localStorage.getItem("courseMap") || "{}");
    let selectedSchool = localStorage.getItem("selectedSchool") || Object.keys(schoolData)[0] || "é è¨­å­¸æ ¡";

    function initSelectors() {
      const now = new Date();
      const year = now.getFullYear();
      yearSelect.innerHTML = "";
      for (let y = year; y <= year + 5; y++) {
        const opt = document.createElement("option");
        opt.value = y;
        opt.text = `${y} å¹´`;
        yearSelect.appendChild(opt);
      }
      yearSelect.value = year;

      monthSelect.innerHTML = "";
      for (let m = 1; m <= 12; m++) {
        const opt = document.createElement("option");
        opt.value = m;
        opt.text = `${m} æœˆ`;
        monthSelect.appendChild(opt);
      }
      monthSelect.value = now.getMonth() + 1;

      updateDateHeaders();
    }

    function updateDateHeaders() {
      const y = parseInt(yearSelect.value);
      const m = parseInt(monthSelect.value);

      // æ‰¾æœ¬æœˆç¬¬ä¸€å¤©
      let firstDay = new Date(y, m - 1, 1);
      // æ‰¾æœ¬æœˆæœ€å¾Œä¸€å¤©
      let lastDay = new Date(y, m, 0);

      // è¨ˆç®—ç•¶é€±é€±ä¸€ï¼ˆå‡è¨­é€±ä¸€ç‚ºä¸€é€±é–‹å§‹ï¼‰
      // è‹¥ä»Šå¤©ä¸åœ¨é€™å€‹æœˆå…§ï¼Œå‰‡é¡¯ç¤ºè©²å¹´æœˆçš„ç¬¬ä¸€é€±é€±ä¸€ç‚ºåŸºæº–
      let today = new Date();
      if (today.getFullYear() !== y || (today.getMonth() + 1) !== m) {
        today = firstDay;
      }

      let dayOfWeek = (today.getDay() + 6) % 7; // é€±ä¸€ = 0
      let monday = new Date(today);
      monday.setDate(today.getDate() - dayOfWeek);

      for (let i = 0; i < 7; i++) {
        const day = new Date(monday);
        day.setDate(monday.getDate() + i);
        const span = document.getElementById(`d${i + 1}`);
        if (day.getFullYear() === y && (day.getMonth() + 1) === m) {
          span.textContent = day.getDate();
        } else {
          span.textContent = "-";
        }
      }
    }

    function saveData() {
      localStorage.setItem("schoolData", JSON.stringify(schoolData));
      localStorage.setItem("courseMap", JSON.stringify(courseMap));
      localStorage.setItem("selectedSchool", selectedSchool);
    }

    function renderSchools() {
      schoolSelect.innerHTML = "";
      Object.keys(schoolData).forEach(school => {
        const opt = document.createElement("option");
        opt.value = school;
        opt.text = school;
        schoolSelect.appendChild(opt);
      });
      if (!schoolData[selectedSchool]) {
        selectedSchool = Object.keys(schoolData)[0] || "é è¨­å­¸æ ¡";
        if (!schoolData[selectedSchool]) {
          schoolData[selectedSchool] = [];
        }
        saveData();
      }
      schoolSelect.value = selectedSchool;
    }

    function renderTable() {
      tableBody.innerHTML = "";
      const students = schoolData[selectedSchool] || [];
      studentCount.textContent = `ğŸ‘¥ å…± ${students.length} ä½å­¸ç”Ÿ`;
      titleSchool.textContent = selectedSchool;
      titleCourse.textContent = `(${courseMap[selectedSchool] || 'å°šæœªè¨­å®š'})`;
      courseInput.value = courseMap[selectedSchool] || '';

      students.forEach(name => {
        const tr = document.createElement("tr");

        // å§“åæ¬„
        const tdName = document.createElement("td");
        tdName.textContent = name;
        tr.appendChild(tdName);

        // 7å¤©é»åæ¬„ä½ (å¯é»æ“Šåˆ‡æ›ç°½åˆ°ç‹€æ…‹)
        for (let i = 0; i < 7; i++) {
          const td = document.createElement("td");
          td.classList.add("day-cell");
          // é€™è£¡å¯æ“´å±•æˆå­˜è³‡æ–™ï¼Œç¾åœ¨åªåˆ‡æ›æ¨£å¼
          td.onclick = () => td.classList.toggle("signed");
          tr.appendChild(td);
        }

        // åˆªé™¤æŒ‰éˆ•æ¬„
        const tdDel = document.createElement("td");
        const delBtn = document.createElement("button");
        delBtn.textContent = "åˆªé™¤";
        delBtn.className = "danger";
        delBtn.onclick = () => {
          if (confirm(`ç¢ºå®šåˆªé™¤å­¸ç”Ÿï¼š${name}ï¼Ÿ`)) {
            schoolData[selectedSchool] = students.filter(s => s !== name);
            saveData();
            renderTable();
          }
        };
        tdDel.appendChild(delBtn);
        tr.appendChild(tdDel);

        tableBody.appendChild(tr);
      });
    }

    function addStudent() {
      const name = studentInput.value.trim();
      if (!name) return alert("è«‹è¼¸å…¥å­¸ç”Ÿå§“å");
      if (!schoolData[selectedSchool]) schoolData[selectedSchool] = [];
      if (schoolData[selectedSchool].includes(name)) return alert("å­¸ç”Ÿå§“åå·²å­˜åœ¨");
      schoolData[selectedSchool].push(name);
      studentInput.value = "";
      saveData();
      renderTable();
    }

    function addSchool() {
      const name = prompt("è«‹è¼¸å…¥å­¸æ ¡åç¨±");
      if (!name) return;
      if (!schoolData[name]) schoolData[name] = [];
      selectedSchool = name;
      saveData();
      renderSchools();
      renderTable();
    }

    function deleteSchool() {
      if (confirm(`ç¢ºå®šåˆªé™¤å­¸æ ¡ï¼š${selectedSchool}ï¼Ÿ`)) {
        delete schoolData[selectedSchool];
        delete courseMap[selectedSchool];
        selectedSchool = Object.keys(schoolData)[0] || "é è¨­å­¸æ ¡";
        if (!schoolData[selectedSchool]) schoolData[selectedSchool] = [];
        saveData();
        renderSchools();
        renderTable();
      }
    }

    function setCourse() {
      const input = courseInput.value.trim();
      if (!input) return alert("è«‹è¼¸å…¥èª²ç¨‹åç¨±");
      courseMap[selectedSchool] = input;
      saveData();
      renderTable();
    }

    yearSelect.onchange = () => {
      updateDateHeaders();
    };
    monthSelect.onchange = () => {
      updateDateHeaders();
    };
    schoolSelect.onchange = () => {
      selectedSchool = schoolSelect.value;
      saveData();
      renderTable();
    };

    // åˆå§‹åŒ–
    initSelectors();
    renderSchools();
    renderTable();
  </script>
</body>
</html>
